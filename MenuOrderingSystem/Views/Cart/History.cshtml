@model IEnumerable<MenuOrderingSystem.Models.Order>

@{
    ViewBag.Title = "My Orders";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold" style="font-family: 'Playfair Display', serif;">My Orders</h1>
        <p class="text-muted">Track your past purchases and current status</p>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <div class="mb-3 text-muted opacity-25">
                <i class="fas fa-receipt fa-4x"></i>
            </div>
            <h3 class="fw-bold text-muted">No orders found</h3>
            <p class="text-muted mb-4">You haven't placed any orders yet.</p>
            <a href="/Drink/Index" class="btn btn-success rounded-pill px-5 py-3 shadow hover-lift"
               style="background-color: var(--chagee-green); border: none;">
                Browse Menu
            </a>
        </div>
    }
    else
    {
        <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-uppercase small text-muted">
                        <tr>
                            <th class="py-3 ps-4">Order ID</th>
                            <th class="py-3">Date</th>
                            <th class="py-3">Items</th>
                            <th class="py-3">Total Amount</th>
                            <th class="py-3 text-center">Status</th>
                            <th class="py-3 pe-4 text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td class="ps-4 fw-bold text-dark">
                                    #@order.OrderID
                                </td>

                                <td class="text-muted">
                                    @order.OrderTime.ToString("dd MMM yyyy") <br>
                                    <small class="text-muted opacity-75">@order.OrderTime.ToString("hh:mm tt")</small>
                                </td>

                                <td>
                                    <span class="badge bg-light text-dark border">
                                        @order.OrderItems.Sum(i => i.Quantity) Items
                                    </span>
                                </td>

                                <td class="fw-bold fs-5" style="color: var(--chagee-green);">
                                    @order.TotalAmount.ToString("C")
                                </td>

                                <td class="text-center">
                                    @if (order.Status == "Paid")
                                    {
                                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-2">
                                            <i class="fas fa-check-circle me-1"></i> Paid
                                        </span>
                                    }
                                    else if (order.Status == "Cancelled")
                                    {
                                        <span class="badge bg-danger bg-opacity-10 text-danger rounded-pill px-3 py-2">
                                            <i class="fas fa-times-circle me-1"></i> Cancelled
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill px-3 py-2">
                                            @order.Status
                                        </span>
                                    }
                                </td>

                                <td class="text-end pe-4">
                                    <a href="/History/Detail/@order.OrderID" class="btn btn-outline-secondary btn-sm rounded-pill px-3 me-1 hover-gold">
                                        View
                                    </a>

                                    @if (order.Status == "Paid" && DateTime.Now.Subtract(order.OrderTime).TotalHours <= 2)
                                    {
                                        <form asp-controller="History" asp-action="Cancel" method="post" class="d-inline"
                                              onsubmit="return confirm('Are you sure you want to cancel Order #@order.OrderID?');">
                                            <input type="hidden" name="id" value="@order.OrderID" />
                                            <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                                                Cancel
                                            </button>
                                        </form>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

<style>
    /* Add subtle hover effect to table rows */
    tr {
        transition: background-color 0.2s;
    }

    /* Custom Gold Hover for the View Button */
    .hover-gold:hover {
        background-color: var(--chagee-gold) !important;
        border-color: var(--chagee-gold) !important;
        color: white !important;
    }
</style>