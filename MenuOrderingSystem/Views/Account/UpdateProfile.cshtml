@using MenuOrderingSystem.Models.ViewModels
@model UpdateProfileVM

@{
    ViewBag.Title = "Account | Update Profile";
}

<style>
    body {
        background: url('/Images/homebg.png') no-repeat center center fixed;
        background-size: cover;
    }

    .upload {
        cursor: pointer;
        display: block;
        text-align: center;
    }

        .upload img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .upload small {
            display: block;
            margin-bottom: 10px;
            color: #6c757d;
        }

    .form-control {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 16px;
    }

    .validation-message {
        color: #dc3545;
        font-size: 14px;
        margin-top: 5px;
    }
</style>

<div class="container mt-4 d-flex justify-content-center">
    <div class="profile-card shadow-lg p-4 rounded-4"
         style="max-width: 600px;
                background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(247,247,249,0.9) 100%);
                border: 1px solid #e5e5e5;">

        <div class="auth-logo text-center mb-4">
            <img src="~/images/logo.png" alt="CHAGEE Logo" style="max-height: 60px;" />
        </div>

        <p class="text-center h4 mb-4">Update Profile</p>

        <form method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

            <!-- Current Profile Photo Display -->
            <div class="text-center mb-4">
                <label class="upload">
                    <img src="/photos/@Model.PhotoURL"
                         alt="Current profile photo"
                         id="profileImage"
                         style="height: 160px; width: 160px;">
                    <small class="text-muted mt-2">Click to change photo</small>
                    <input asp-for="Photo" accept="image/jpeg,image/png" hidden onchange="previewImage(this)">
                </label>
                <span asp-validation-for="Photo" class="validation-message d-block text-center"></span>
            </div>

            <div class="px-2">
                <!-- Email Field (Read-only) -->
                <div class="info-row mb-3">
                    <label asp-for="Email" class="text-muted small"></label>
                    <p class="fs-5 fw-semibold">@Model.Email</p>
                </div>

                <!-- Name Field -->
                <div class="info-row mb-3">
                    <label asp-for="Name" class="text-muted small"></label>
                    <input asp-for="Name" class="form-control" autofocus>
                    <span asp-validation-for="Name" class="validation-message"></span>
                </div>


                <!-- Buttons -->
                <div class="info-row mb-4 d-flex justify-content-center gap-3">
                    <button type="submit" class="btn btn-outline-dark py-2 rounded-3 shadow-sm"
                            style="letter-spacing: .5px; border-width:2px; min-width: 140px;">
                        💾 Update Profile
                    </button>
                    <button type="reset" class="btn btn-outline-secondary py-2 rounded-3 shadow-sm"
                            style="letter-spacing: .5px; border-width:2px; min-width: 140px;">
                        🔄 Reset
                    </button>
                </div>

                <!-- Back to Profile Link -->
                <div class="info-row mb-4 d-flex justify-content-center">
                    <a href="/Account/Profile"
                       class="btn btn-outline-dark w-50 py-2 rounded-3 shadow-sm text-center"
                       style="letter-spacing: .5px; border-width:2px;">
                        ← Back to Profile
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profileImage').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Click on image to trigger file input
    document.getElementById('profileImage').addEventListener('click', function() {
        document.querySelector('input[type="file"]').click();
    });
</script>