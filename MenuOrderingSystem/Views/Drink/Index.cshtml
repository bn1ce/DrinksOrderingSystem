@model MenuOrderingSystem.Models.ViewModels.DrinkMenuViewModel

@{
    ViewBag.Title = "Menu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="position-relative text-center text-white mb-5"
     style="background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('@Url.Content("~/Images/menubg.png")'); background-size: cover; background-position: center; padding: 100px 20px 60px; margin-top: -20px;">
    <h1 class="display-4 fw-bold mb-2">Discover Oriental Tea</h1>
    <p class="lead mb-4 opacity-75">Premium Tea • Fresh Milk • Modern Taste</p>

    <div class="bg-white p-2 rounded-pill shadow-lg d-inline-flex align-items-center flex-wrap justify-content-center mx-auto" style="max-width: 700px; width: 100%;">
        <i class="fas fa-search text-muted ms-3"></i>
        <input type="text" name="search" class="form-control border-0 shadow-none" placeholder="Search drinks..." style="min-width: 200px;">

        <select name="sort" class="form-select border-0 shadow-none bg-light rounded-pill ms-2" style="width: auto; font-weight: 600;">
            <option value="">Sort By</option>
            <option value="name-asc">Name A-Z</option>
            <option value="name-desc">Name Z-A</option>
            <option value="price-asc">Price Low → High</option>
            <option value="price-desc">Price High → Low</option>
        </select>
        <input type="hidden" name="categoryId" value="@Model.SelectedCategoryId" />
    </div>
</div>

<div class="container pb-5">
    <div class="d-flex justify-content-center mb-5 overflow-auto">
        <div class="nav nav-pills p-1 bg-light rounded-pill" id="drinkCategoryTabs" style="border: 1px solid #eee;">
            @foreach (var category in Model.Categories)
            {
                bool isActive = category.CategoryID == Model.SelectedCategoryId;
                <a class="nav-link rounded-pill px-4 py-2 fw-bold @(isActive ? "active-tab" : "text-muted")"
                   href="#"
                   data-category="@category.CategoryID"
                   style="transition: 0.3s;">
                    @category.CategoryName
                </a>
            }
        </div>
    </div>

    <div id="drinks-container">
        @Html.Partial("_DrinkList", Model.Drinks)
    </div>
</div>

<style>
    /* Custom Active State for Tabs to match Gold/Green theme */
    .active-tab {
        background-color: var(--chagee-green) !important;
        color: white !important;
        box-shadow: 0 4px 10px rgba(45, 90, 39, 0.3);
    }
</style>

@section foot {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function loadDrinks() {
            var search = $("input[name='search']").val();
            var sort = $("select[name='sort']").val();
            var categoryId = $("input[name='categoryId']").val();

            $.get('@Url.Action("Filter", "Drink")', { categoryId: categoryId, search: search, sort: sort }, function (result) {
                $("#drinks-container").hide().html(result).fadeIn(300);
            });
        }

        $(document).ready(function () {
            // Live Search
            $("input[name='search']").on("keyup", loadDrinks);
            // Sorting
            $("select[name='sort']").on("change", loadDrinks);

            // Category Click
            $("#drinkCategoryTabs a").on("click", function (e) {
                e.preventDefault();
                var categoryId = $(this).data("category");
                $("input[name='categoryId']").val(categoryId);

                // Update UI classes
                $("#drinkCategoryTabs a").removeClass("active-tab").addClass("text-muted");
                $(this).removeClass("text-muted").addClass("active-tab");

                loadDrinks();
            });
        });
    </script>
}